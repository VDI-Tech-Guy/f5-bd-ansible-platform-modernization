---

- name: Wait until host is powered off (port unreachable)
  ansible.builtin.wait_for:
    host: "{{ ansible_host }}"
    port: 22
    state: drained  # Wait until port is CLOSED (host offline)
    timeout: 30
  register: port_check
  until: port_check.failed
  retries: 30
  delay: 10
  delegate_to: localhost
